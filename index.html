<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kapsamlı KPSS Önlisans Planlayıcısı</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e; --surface-color: #16213e; --primary-color: #0f3460;
            --secondary-color: #e94560; --text-color: #e0e0e0; --text-muted: #a0a0a0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--bg-color);
            color: var(--text-color); line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
        nav {
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            background-color: var(--surface-color); padding: 0.5rem 1rem;
            border-radius: 12px; margin-bottom: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .nav-links { display: flex; flex-wrap: wrap; justify-content: center; }
        .nav-link {
            padding: 0.8rem 1rem; border: none; background: none; color: var(--text-muted);
            cursor: pointer; font-size: 0.9rem; font-weight: 600; border-radius: 8px;
            transition: background-color 0.2s, color 0.2s;
        }
        .nav-link.active, .nav-link:hover { background-color: var(--secondary-color); color: white; }
        #logout-btn {
            background-color: transparent; border: 1px solid var(--secondary-color); color: var(--secondary-color);
            padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        #logout-btn:hover { background-color: var(--secondary-color); color: white; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .widget {
            background-color: var(--surface-color); border-radius: 12px;
            padding: 1.5rem; margin-bottom: 1.5rem;
        }
        h2 { color: white; margin-bottom: 1rem; font-size: 1.5rem; border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem; }
        h3 { color: var(--text-color); margin-bottom: 1rem; font-size: 1.2rem; }

        /* YENİ: Oturum Açma Ekranı Stilleri */
        #auth-container {
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }
        .auth-box {
            background-color: var(--surface-color); padding: 2.5rem; border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4); text-align: center; max-width: 400px; width: 100%;
        }
        .auth-box h2 { border: none; }
        .auth-form input {
            width: 100%; padding: 0.8rem; margin-bottom: 1rem; background-color: var(--bg-color);
            border: 1px solid var(--primary-color); color: var(--text-color); border-radius: 5px; font-size: 1rem;
        }
        .auth-form button {
            width: 100%; padding: 0.8rem; background-color: var(--secondary-color); color: white;
            border: none; border-radius: 5px; cursor: pointer; font-size: 1.1rem; font-weight: 600;
        }
        .auth-toggle-link {
            margin-top: 1.5rem; color: var(--text-muted); cursor: pointer;
        }
        .auth-toggle-link:hover { color: var(--secondary-color); }
        #auth-error { color: var(--secondary-color); margin-top: 1rem; min-height: 1.2rem; }
        #app-container { display: none; } /* Başlangıçta uygulamayı gizle */
        
        /* Dashboard */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        #countdown .countdown-grid { display: grid; grid-template-columns: repeat(4, 1fr); text-align: center; }
        .countdown-item { font-size: 2rem; font-weight: 700; } .countdown-item span { display: block; font-size: 0.8rem; color: var(--text-muted); }

        /* Konu Takibi */
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .subject-card { background-color: var(--primary-color); padding: 1rem; border-radius: 8px; }
        .subject-card progress { width: 100%; margin: 0.5rem 0; }
        .topic-list { list-style: none; padding-left: 0.5rem; max-height: 250px; overflow-y: auto; }
        .topic-list li { margin-bottom: 0.5rem; }
        .topic-list label { display: flex; align-items: center; cursor: pointer; }
        .topic-list input[type="checkbox"] { margin-right: 0.8rem; }
        .topic-list input:checked + span { text-decoration: line-through; color: var(--text-muted); }

        /* Deneme Analizi */
        #deneme-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        #deneme-form input { width: 100%; padding: 0.5rem; background-color: var(--bg-color); border: 1px solid var(--primary-color); color: var(--text-color); border-radius: 5px; }
        #deneme-form button { background-color: var(--secondary-color); color: white; border: none; padding: 0.8rem; border-radius: 5px; cursor: pointer; grid-column: 1 / -1; }
        #deneme-history { width: 100%; overflow-x: auto; margin-top: 1.5rem; }
        #deneme-history table { width: 100%; border-collapse: collapse; }
        #deneme-history th, #deneme-history td { padding: 0.8rem; text-align: center; border: 1px solid var(--primary-color); }
        #deneme-history th { background-color: var(--primary-color); }
        
        /* Haftalık Plan */
        .weekly-plan-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .day-card textarea { width: 100%; min-height: 150px; background-color: var(--bg-color); border: 1px solid var(--primary-color); color: var(--text-color); border-radius: 5px; padding: 0.5rem; }

        /* Ayarlar */
        .settings-form label { display: block; margin-bottom: 0.5rem; }
        .settings-form input { padding: 0.5rem; background-color: var(--bg-color); border: 1px solid var(--primary-color); color: var(--text-color); border-radius: 5px; }
        .settings-form button { background-color: var(--secondary-color); color: white; border: none; padding: 0.8rem; border-radius: 5px; cursor: pointer; margin-top: 1rem; }
    </style>
</head>
<body>
    <div id="auth-container">
        <div class="auth-box">
            <div id="login-view">
                <h2>Giriş Yap</h2>
                <form id="login-form" class="auth-form">
                    <input type="text" id="login-username" placeholder="Kullanıcı Adı" required>
                    <input type="password" id="login-password" placeholder="Şifre" required>
                    <button type="submit">Giriş Yap</button>
                </form>
                <p id="auth-error"></p>
                <p class="auth-toggle-link" id="show-register-view">Hesabın yok mu? Kayıt ol.</p>
            </div>
            <div id="register-view" style="display:none;">
                <h2>Kayıt Ol</h2>
                <form id="register-form" class="auth-form">
                    <input type="text" id="register-username" placeholder="Kullanıcı Adı" required>
                    <input type="password" id="register-password" placeholder="Şifre" required>
                    <button type="submit">Kayıt Ol</button>
                </form>
                <p class="auth-toggle-link" id="show-login-view">Zaten hesabın var mı? Giriş yap.</p>
            </div>
        </div>
    </div>

    <div id="app-container" class="container">
        <nav>
            <div class="nav-links">
                <button class="nav-link active" data-target="dashboard-page">Ana Sayfa</button>
                <button class="nav-link" data-target="konu-takip-page">Konu Takibi</button>
                <button class="nav-link" data-target="deneme-analiz-page">Deneme Analizi</button>
                <button class="nav-link" data-target="haftalik-plan-page">Haftalık Plan</button>
                <button class="nav-link" data-target="ayarlar-page">Ayarlar</button>
            </div>
            <button id="logout-btn">Çıkış Yap</button>
        </nav>

        <main>
            <section id="dashboard-page" class="page active">
                <div class="dashboard-grid">
                    <div id="countdown" class="widget">
                        <h2>Sınava Kalan Süre</h2>
                        <div class="countdown-grid">
                            <div class="countdown-item"><div id="days">00</div><span>Gün</span></div>
                            <div class="countdown-item"><div id="hours">00</div><span>Saat</span></div>
                            <div class="countdown-item"><div id="minutes">00</div><span>Dakika</span></div>
                            <div class="countdown-item"><div id="seconds">00</div><span>Saniye</span></div>
                        </div>
                    </div>
                    <div class="widget">
                        <h2>Günün Özeti</h2>
                        <p id="quote" style="margin-top: 1rem; font-style: italic; color: var(--text-muted);"></p>
                    </div>
                    <div class="widget">
                        <h2>Bugünkü Görevler</h2>
                        <input type="text" id="todo-input" placeholder="Yeni görev ekle..." style="width: 100%; padding: 0.5rem; background-color: var(--bg-color); border: 1px solid var(--primary-color); color: var(--text-color); border-radius: 5px; margin-bottom: 1rem;">
                        <ul id="todo-list" style="list-style: none;"></ul>
                    </div>
                </div>
            </section>

            <section id="konu-takip-page" class="page">
                <h2>Konu Takip Çizelgesi</h2>
                <div class="subject-grid"></div>
            </section>

            <section id="deneme-analiz-page" class="page">
                <div class="widget">
                    <h2>Yeni Deneme Ekle</h2>
                    <form id="deneme-form">
                        <div>
                            <label for="deneme-adi">Deneme Adı/No:</label>
                            <input type="text" id="deneme-adi" required>
                        </div>
                        <fieldset style="border:1px solid var(--primary-color); padding:1rem; border-radius:8px;">
                            <legend>Genel Yetenek</legend>
                            <label>Türkçe (D/Y/B):</label>
                            <div style="display:flex; gap:5px;">
                                <input type="number" class="deneme-input" placeholder="D" min="0"><input type="number" class="deneme-input" placeholder="Y" min="0"><input type="number" class="deneme-input" placeholder="B" min="0">
                            </div>
                            <label>Matematik (D/Y/B):</label>
                            <div style="display:flex; gap:5px;">
                                <input type="number" class="deneme-input" placeholder="D" min="0"><input type="number" class="deneme-input" placeholder="Y" min="0"><input type="number" class="deneme-input" placeholder="B" min="0">
                            </div>
                        </fieldset>
                        <fieldset style="border:1px solid var(--primary-color); padding:1rem; border-radius:8px;">
                            <legend>Genel Kültür</legend>
                            <label>Tarih (D/Y/B):</label>
                            <div style="display:flex; gap:5px;">
                                <input type="number" class="deneme-input" placeholder="D" min="0"><input type="number" class="deneme-input" placeholder="Y" min="0"><input type="number" class="deneme-input" placeholder="B" min="0">
                            </div>
                            <label>Coğrafya (D/Y/B):</label>
                            <div style="display:flex; gap:5px;">
                                <input type="number" class="deneme-input" placeholder="D" min="0"><input type="number" class="deneme-input" placeholder="Y" min="0"><input type="number" class="deneme-input" placeholder="B" min="0">
                            </div>
                            <label>Vatandaşlık (D/Y/B):</label>
                            <div style="display:flex; gap:5px;">
                                <input type="number" class="deneme-input" placeholder="D" min="0"><input type="number" class="deneme-input" placeholder="Y" min="0"><input type="number" class="deneme-input" placeholder="B" min="0">
                            </div>
                        </fieldset>
                        <button type="submit">Denemeyi Kaydet</button>
                    </form>
                </div>
                <div class="widget">
                    <h2>Deneme Geçmişi</h2>
                    <div id="deneme-history"><table></table></div>
                </div>
            </section>

            <section id="haftalik-plan-page" class="page">
                <h2>Haftalık Çalışma Planı</h2>
                <div class="weekly-plan-grid"></div>
            </section>

            <section id="ayarlar-page" class="page">
                <div class="widget">
                    <h2>Ayarlar</h2>
                    <div class="settings-form">
                        <label for="exam-date">KPSS Sınav Tarihini Ayarla:</label>
                        <input type="date" id="exam-date">
                        <button id="save-settings">Ayarları Kaydet</button>
                        <p id="settings-saved-msg" style="color:var(--secondary-color); margin-top:1rem;"></p>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
// Bu script artık çok daha kapsamlı. Tüm mantık burada.
document.addEventListener('DOMContentLoaded', () => {

    // --- KULLANICI YÖNETİMİ VE VERİTABANI ---
    const authContainer = document.getElementById('auth-container');
    const appContainer = document.getElementById('app-container');
    const loginView = document.getElementById('login-view');
    const registerView = document.getElementById('register-view');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const authError = document.getElementById('auth-error');
    const logoutBtn = document.getElementById('logout-btn');

    // Basit veritabanı: Tüm kullanıcılar ve verileri burada saklanacak.
    let userDatabase = JSON.parse(localStorage.getItem('kpssO_userDatabase')) || {};
    let currentUser = sessionStorage.getItem('kpssO_currentUser');

    const saveDatabase = () => localStorage.setItem('kpssO_userDatabase', JSON.stringify(userDatabase));

    // Form değiştirme linkleri
    document.getElementById('show-register-view').addEventListener('click', () => {
        loginView.style.display = 'none';
        registerView.style.display = 'block';
        authError.textContent = '';
    });
    document.getElementById('show-login-view').addEventListener('click', () => {
        registerView.style.display = 'none';
        loginView.style.display = 'block';
        authError.textContent = '';
    });

    // Kayıt olma işlemi
    registerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('register-username').value.trim();
        const password = document.getElementById('register-password').value;

        if (userDatabase[username]) {
            authError.textContent = 'Bu kullanıcı adı zaten alınmış.';
            return;
        }
        // Yeni kullanıcı için varsayılan veri yapısı
        userDatabase[username] = {
            password: password, // Gerçek bir uygulamada şifre hashlenmelidir!
            settings: { examDate: '2026-09-06' },
            topicProgress: {},
            denemeHistory: [],
            weeklyPlan: {},
            todos: {}
        };
        saveDatabase();
        alert('Kayıt başarılı! Şimdi giriş yapabilirsiniz.');
        document.getElementById('show-login-view').click();
    });
    
    // Giriş yapma işlemi
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;

        if (userDatabase[username] && userDatabase[username].password === password) {
            sessionStorage.setItem('kpssO_currentUser', username);
            currentUser = username;
            initializeApp();
        } else {
            authError.textContent = 'Kullanıcı adı veya şifre hatalı.';
        }
    });

    // Çıkış yapma işlemi
    logoutBtn.addEventListener('click', () => {
        sessionStorage.removeItem('kpssO_currentUser');
        currentUser = null;
        authContainer.style.display = 'flex';
        appContainer.style.display = 'none';
    });

    // --- UYGULAMA BAŞLATMA ---
    function initializeApp() {
        if (!currentUser) {
            authContainer.style.display = 'flex';
            appContainer.style.display = 'none';
            return;
        }
        
        authContainer.style.display = 'none';
        appContainer.style.display = 'block';

        // Geri kalan tüm uygulama kodları buraya taşındı ve
        // artık verileri `userDatabase[currentUser]` üzerinden okuyup yazacak.
        
        let userData = userDatabase[currentUser];

        const saveData = () => {
            userDatabase[currentUser] = userData;
            saveDatabase();
        }

        // --- TEMEL YAPI VE VERİLER ---
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        const kpssData = {
            'Tarih': ['İslamiyet Öncesi Türk Tarihi', 'İlk Müslüman Türk Devletleri', 'Osmanlı Kuruluş ve Yükselme', 'Osmanlı Kültür ve Medeniyeti', 'Osmanlı Duraklama ve Gerileme', 'Osmanlı Dağılma', '20. Yüzyılda Osmanlı', 'Kurtuluş Savaşı Hazırlık', 'Kurtuluş Savaşı Muharebeler', 'İnkılaplar', 'Atatürk Dönemi İç ve Dış Politika', 'Çağdaş Türk ve Dünya Tarihi'],
            'Coğrafya': ['Türkiye\'nin Coğrafi Konumu', 'Türkiye\'nin Yer Şekilleri ve İklimi', 'Türkiye\'de Nüfus ve Yerleşme', 'Tarım ve Hayvancılık', 'Madenler ve Enerji Kaynakları', 'Sanayi ve Ticaret', 'Ulaşım ve Turizm', 'Bölgeler Coğrafyası'],
            'Vatandaşlık': ['Temel Hukuk Kavramları', 'Anayasa Hukukuna Giriş', 'Yasama', 'Yürütme', 'Yargı', 'İdare Hukuku', 'İnsan Hakları'],
            'Türkçe': ['Sözcükte Anlam', 'Cümlede Anlam', 'Paragraf', 'Yazım Kuralları', 'Noktalama İşaretleri', 'Ses Bilgisi', 'Yapı Bilgisi', 'Sözcük Türleri', 'Cümlenin Öğeleri', 'Cümle Türleri', 'Anlatım Bozuklukları', 'Sözel Mantık'],
            'Matematik': ['Temel Kavramlar', 'Sayılar', 'Bölme ve Bölünebilme', 'OBEB-OKEK', 'Rasyonel Sayılar', 'Basit Eşitsizlikler', 'Mutlak Değer', 'Üslü ve Köklü Sayılar', 'Çarpanlara Ayırma', 'Oran-Orantı', 'Denklem Çözme', 'Problemler', 'Kümeler', 'İşlem ve Modüler Aritmetik', 'Permütasyon ve Olasılık', 'Sayısal Mantık', 'Geometri']
        };

        // --- SAYFA NAVİGASYONU ---
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                const target = link.dataset.target;
                pages.forEach(page => page.classList.toggle('active', page.id === target));
            });
        });

        // --- AYARLAR ---
        const examDateInput = document.getElementById('exam-date');
        const saveSettingsBtn = document.getElementById('save-settings');
        const settingsMsg = document.getElementById('settings-saved-msg');
        examDateInput.value = userData.settings.examDate;

        saveSettingsBtn.addEventListener('click', () => {
            userData.settings.examDate = examDateInput.value;
            saveData();
            settingsMsg.textContent = "Ayarlar kaydedildi. Geri sayım güncellendi.";
            setTimeout(() => settingsMsg.textContent = "", 3000);
            // Geri sayımı yeniden başlat
            startCountdown();
        });

        // --- GERİ SAYIM SAYACI (ANA SAYFA) ---
        let countdownInterval;
        const startCountdown = () => {
            clearInterval(countdownInterval);
            const kpssExamDate = new Date(`${userData.settings.examDate}T10:15:00`).getTime();
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = kpssExamDate - now;
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').innerHTML = "<h2>Başarılar!</h2>";
                    return;
                }
                document.getElementById('days').innerText = Math.floor(distance / (1000 * 60 * 60 * 24));
                document.getElementById('hours').innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById('minutes').innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById('seconds').innerText = Math.floor((distance % (1000 * 60)) / 1000);
            }, 1000);
        };
        startCountdown();

        // --- GÜNLÜK GÖREVLER (ANA SAYFA) ---
        const todoInput = document.getElementById('todo-input');
        const todoList = document.getElementById('todo-list');
        const todayStr = new Date().toISOString().slice(0, 10);
        
        // Günlük görevleri kullanıcı verisinden al
        if (!userData.todos[todayStr]) {
            userData.todos[todayStr] = [];
        }
        let todos = userData.todos[todayStr];

        const renderTodos = () => {
            todoList.innerHTML = '';
            todos.forEach((todo, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<label style="display:flex; align-items:center; cursor:pointer;"><input type="checkbox" ${todo.completed ? 'checked' : ''} style="margin-right: 10px;"><span>${todo.text}</span></label><button style="background:none; border:none; color:var(--secondary-color); cursor:pointer; font-size:1.2rem; margin-left:auto;">&times;</button>`;
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                li.style.marginBottom = '5px';
                if (todo.completed) li.querySelector('span').style.textDecoration = 'line-through';
                
                li.querySelector('input').addEventListener('change', () => {
                    todos[index].completed = !todos[index].completed;
                    saveAndRenderTodos();
                });
                li.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    todos.splice(index, 1);
                    saveAndRenderTodos();
                });
                todoList.appendChild(li);
            });
        };
        const saveAndRenderTodos = () => {
            userData.todos[todayStr] = todos;
            saveData();
            renderTodos();
        };
        todoInput.addEventListener('keypress', e => {
            if (e.key === 'Enter' && todoInput.value.trim()) {
                todos.push({ text: todoInput.value, completed: false });
                todoInput.value = '';
                saveAndRenderTodos();
            }
        });
        renderTodos();
        
        // --- MOTİVASYON SÖZÜ (ANA SAYFA) ---
        const quotes = ["Başarının sırrı, başlamaktır.", "Bugünün tekrarı, yarının netidir.", "Unutma, her net bir adımdır.", "En büyük zafer, hiç düşmemek değil, her düştüğünde kalkabilmektir."];
        document.getElementById('quote').textContent = quotes[Math.floor(Math.random() * quotes.length)];

        // --- KONU TAKİBİ ---
        const subjectGrid = document.querySelector('#konu-takip-page .subject-grid');
        subjectGrid.innerHTML = ''; // Temizle
        let topicProgress = userData.topicProgress;

        Object.keys(kpssData).forEach(subject => {
            const card = document.createElement('div');
            card.className = 'subject-card';
            const topicListHTML = kpssData[subject].map((topic, index) => {
                const topicId = `${subject}-${index}`;
                const isChecked = topicProgress[topicId] ? 'checked' : '';
                return `<li><label><input type="checkbox" data-id="${topicId}" ${isChecked}><span>${topic}</span></label></li>`;
            }).join('');
            card.innerHTML = `<h3>${subject}</h3><progress value="0" max="100"></progress><p class="progress-text">0%</p><ul class="topic-list">${topicListHTML}</ul>`;
            subjectGrid.appendChild(card);
        });

        const updateProgress = () => {
            Object.keys(kpssData).forEach(subject => {
                const topics = kpssData[subject];
                const checkedCount = topics.filter((t, i) => topicProgress[`${subject}-${i}`]).length;
                const progress = topics.length > 0 ? Math.round((checkedCount / topics.length) * 100) : 0;
                const card = [...subjectGrid.children].find(c => c.querySelector('h3').textContent === subject);
                if (card) {
                    card.querySelector('progress').value = progress;
                    card.querySelector('.progress-text').textContent = `${progress}% tamamlandı.`;
                }
            });
        };

        subjectGrid.addEventListener('change', e => {
            if (e.target.type === 'checkbox') {
                topicProgress[e.target.dataset.id] = e.target.checked;
                userData.topicProgress = topicProgress;
                saveData();
                updateProgress();
            }
        });
        updateProgress();

        // --- DENEME ANALİZİ ---
        const denemeForm = document.getElementById('deneme-form');
        const denemeHistoryDiv = document.getElementById('deneme-history');
        let denemeHistory = userData.denemeHistory;

        const renderDenemeHistory = () => {
            let tableHTML = '<table><thead><tr><th>Deneme</th><th>Toplam Net</th><th>GY Net</th><th>GK Net</th><th>Tarih</th></tr></thead><tbody>';
            denemeHistory.forEach(deneme => {
                tableHTML += `<tr><td>${deneme.name}</td><td>${deneme.totalNet.toFixed(2)}</td><td>${deneme.gyNet.toFixed(2)}</td><td>${deneme.gkNet.toFixed(2)}</td><td>${deneme.date}</td></tr>`;
            });
            tableHTML += '</tbody></table>';
            denemeHistoryDiv.innerHTML = tableHTML;
        };

        denemeForm.addEventListener('submit', e => {
            e.preventDefault();
            const inputs = e.target.querySelectorAll('.deneme-input');
            const allValues = [...inputs].map(input => Number(input.value) || 0);
            
            const calculateNet = (d, y) => d - (y / 4);
            
            const gyTurkceNet = calculateNet(allValues[0], allValues[1]);
            const gyMatNet = calculateNet(allValues[3], allValues[4]);
            const gkTarNet = calculateNet(allValues[6], allValues[7]);
            const gkCogNet = calculateNet(allValues[9], allValues[10]);
            const gkVatNet = calculateNet(allValues[12], allValues[13]);
            
            const gyNet = gyTurkceNet + gyMatNet;
            const gkNet = gkTarNet + gkCogNet + gkVatNet;
            
            denemeHistory.push({
                name: document.getElementById('deneme-adi').value,
                gyNet: gyNet,
                gkNet: gkNet,
                totalNet: gyNet + gkNet,
                date: new Date().toLocaleDateString('tr-TR')
            });
            userData.denemeHistory = denemeHistory;
            saveData();
            renderDenemeHistory();
            denemeForm.reset();
        });
        renderDenemeHistory();

        // --- HAFTALIK PLAN ---
        const weeklyPlanGrid = document.querySelector('#haftalik-plan-page .weekly-plan-grid');
        weeklyPlanGrid.innerHTML = ''; // Temizle
        const days = ['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi', 'Pazar'];
        let weeklyPlan = userData.weeklyPlan;

        days.forEach(day => {
            const dayCard = document.createElement('div');
            dayCard.className = 'day-card widget';
            dayCard.innerHTML = `<h3>${day}</h3><textarea data-day="${day}" placeholder="Hedeflerini yaz..."></textarea>`;
            const textarea = dayCard.querySelector('textarea');
            textarea.value = weeklyPlan[day] || '';
            textarea.addEventListener('input', () => {
                weeklyPlan[day] = textarea.value;
                userData.weeklyPlan = weeklyPlan;
                saveData();
            });
            weeklyPlanGrid.appendChild(dayCard);
        });

    } // initializeApp fonksiyonunun sonu
    
    // Sayfa yüklendiğinde oturum kontrolü yap ve uygulamayı başlat
    initializeApp();
});
</script>
</body>
</html>
